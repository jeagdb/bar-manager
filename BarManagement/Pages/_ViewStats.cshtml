@page
@model BarManagement.Pages.StatsModel
@{
    ViewData["Title"] = "Stats";
}

<div class="text-center">
    <h1 class="display-4 mb-5">STATISTIQUES</h1>
</div>

@for (int i = 0; i < Model.CocktailsSortedByCategory.Count; i++)
{
    string category = @Model.CocktailsSortedByCategory[i][0].CocktailCategory;
    var imgPath = Model.GetCategoryIconPath(category);
    <div class="text-center" style="margin-top:30px">
        <table class="table">
            <thead>
                <tr>
                    <div style="display: inline-flex">
                        <img src="@Url.Content(imgPath)" width="50" height="50" />
                        <h2>@(category)</h2>
                    </div>
                </tr>
                <tr>
                    <th>
                        Boissons
                    </th>
                    <th>
                        Nombre de verres vendu
                    </th>
                    <th>
                        Bénéfice par verre (€)
                    </th>
                    <th>
                        Bénéfice total (€)
                    </th>
                    <th>
                        Rentabilité (%)
                    </th>
                </tr>
            </thead>
            @{
                var categoryCocktailList = Model.CocktailsSortedByCategory[i];
                double[] stats = Model.CurrentCocktailStats(i, 0);
                (double maxNbSold, double secondMaxNbSold) = Model.FindMaxNbSoldGlassesByCategory(i);
                (double minNbSold, double secondMinNbSOld) = Model.FindMinNbGlassesSoldByCategory(i);
            }
            @for (int j = 0; j < categoryCocktailList.Count; j++)
            {
                Cocktails currentCocktail = Model.CocktailsSortedByCategory[i][j];
                stats = @Model.CurrentCocktailStats(i, j);
                Boolean isGreen = (stats[0] == maxNbSold || stats[0] == secondMaxNbSold);
                Boolean isRed = (stats[0] == minNbSold || stats[0] == secondMinNbSOld);
                if (isGreen)
                {
                    <tbody>
                        <tr style="background-color: rgba(43, 155, 55, 0.4); border-bottom: solid; border-bottom-color: #ddd;">
                            <td>
                                @(currentCocktail.Name)
                            </td>
                            <td>
                                @(stats[0])
                            </td>
                            <td>
                                @(stats[1])
                            </td>
                            <td>
                                @(stats[2])
                            </td>
                            <td>
                                @(stats[3])
                            </td>
                        </tr>
                    </tbody>
                }
                else if (isRed)
                {
                    <tbody>
                        <tr style="background-color: rgba(162, 25, 25, 0.4); border-bottom: solid; border-bottom-color: #ddd;">
                            <td>
                                @(currentCocktail.Name)
                            </td>
                            <td>
                                @(stats[0])
                            </td>
                            <td>
                                @(stats[1])
                            </td>
                            <td>
                                @(stats[2])
                            </td>
                            <td>
                                @(stats[3])
                            </td>
                        </tr>
                    </tbody>
                }
                else
                {
                    <tbody>
                        <tr>
                            <td>
                                @(currentCocktail.Name)
                            </td>
                            <td>
                                @(stats[0])
                            </td>
                            <td>
                                @(stats[1])
                            </td>
                            <td>
                                @(stats[2])
                            </td>
                            <td>
                                @(stats[3])
                            </td>
                        </tr>
                    </tbody>
                }
            }

        </table>
    </div>
}

